webpackJsonp([7],{"4/lZ":function(e,t){},"Ay/5":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("Xxa5"),s=a.n(i),n=a("exGp"),r=a.n(n),l=a("uaSg"),o=a("1h8J"),c={data:function(){return{isEdit:!1,isMain:!1,dialogVisible:!1,title:"新增一级分类",brandName:"",logoPic:"",baseUrl:"",imageUrl:"",fid:"",id:""}},mounted:function(){this.baseUrl=l.b},methods:{doSave:function(){var e=this;return r()(s.a.mark(function t(){var a,i;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.brandName){t.next=5;break}return e.$message({showClose:!0,message:"请输入分类名称",type:"warning"}),t.abrupt("return");case 5:if(e.logoPic){t.next=8;break}return e.$message({showClose:!0,message:"请上传分类图片",type:"warning"}),t.abrupt("return");case 8:return a={},!e.isEdit&&e.isMain?a={cate_name:e.brandName,image_url:e.logoPic,fid:e.fid}:e.isEdit||e.isMain?e.isEdit&&(a={cate_name:e.brandName,image_url:e.logoPic,fid:e.fid,id:e.id}):a={cate_name:e.brandName,image_url:e.logoPic,fid:e.id},t.next=12,Object(o.y)(a);case 12:0==(i=t.sent).code?(e.$message({showClose:!0,message:"创建成功",type:"success"}),e.$parent.getData(),e.dialogVisible=!1):e.$message({showClose:!0,message:i.message,type:"error"});case 14:case"end":return t.stop()}},t,e)}))()},showClassPop:function(e,t){this.dialogVisible=!0,this.brandName="",this.logoPic="",this.imageUrl="",0==e?(this.title="新增一级分类",this.isMain=!0,this.isEdit=!1,this.fid=0,this.id=""):1==e?(this.title="新增二级分类",this.isMain=!1,this.isEdit=!1,this.fid=t.fid,this.id=t.id):2==e&&(this.title="编辑分类",this.brandName=t.cate_name,this.logoPic=t.image_url,this.imageUrl=t.image_url_full,0==t.fid?this.isMain=!0:this.isMain=!1,this.fid=t.fid,this.id=t.id,this.isEdit=!0)},handleClose:function(){this.dialogVisible=!1,this.brandName="",this.logoPic="",this.imageUrl=""},beforeAvatarUpload:function(e){var t="image/png"===e.type||"image/jpg"===e.type||"image/jpeg"===e.type,a=e.size/1024/1024<.2;return t?!!a||(this.$message.error("上传图片大小不能超过 300k!"),!1):(this.$message.error("上传图片格式有误!"),!1)},handleAvatarSuccess:function(e,t){this.imageUrl=URL.createObjectURL(t.raw),this.logoPic=e.data.url,this.imgId=e.data.id}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"virForm",attrs:{title:e.title,visible:e.dialogVisible,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-row",{staticClass:"flex mb2"},[a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:e.isMain?"请输入一级分类名称":"请输入二级分类名称"},model:{value:e.brandName,callback:function(t){e.brandName=t},expression:"brandName"}})],1),e._v(" "),a("el-row",{staticClass:"flex ruleForm"},[a("el-row",{staticClass:"vFlex"},[a("el-upload",{staticClass:"avatar-uploader",attrs:{"before-upload":e.beforeAvatarUpload,action:e.baseUrl+"/admin/upload/img","show-file-list":!1,"on-success":e.handleAvatarSuccess}},[e.imageUrl?a("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),e._v(" "),a("el-row",{staticClass:"mt2"},[e._v("格式：png、jpg；尺寸：M*N；200K以内")])],1)],1),e._v(" "),a("el-row",{staticClass:"flex mt2"},[a("el-button",{attrs:{type:"primary"},on:{click:e.doSave}},[e._v(e._s(e.isEdit?"保存":"新增"))])],1)],1)],1)},staticRenderFns:[]};var u={data:function(){return{baseUrl:"",dialogVisible:!1,page_size:100,curPage:1,total:0,title:"添加",imageUrl:"",imgId:"",tableData:[],origionPic:""}},components:{AddNewClass:a("VU/8")(c,d,!1,function(e){a("GAq7")},"data-v-299d89bc",null).exports},mounted:function(){this.getData()},methods:{previewImg:function(e){this.dialogVisible=!0,this.origionPic=e},getData:function(){var e=this;return r()(s.a.mark(function t(){var a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(o.f)({page_size:e.page_size,page:e.curPage});case 2:(a=t.sent).data.data.forEach(function(e){e.son.length?e.candel=!0:e.candel=!1}),0==a.code&&(e.tableData=a.data.data,e.total=a.data.total);case 5:case"end":return t.stop()}},t,e)}))()},addMainClass:function(){this.$refs.addNewClass.showClassPop(0,"")},addSubClass:function(e){this.$refs.addNewClass.showClassPop(1,e)},editRow:function(e){this.$refs.addNewClass.showClassPop(2,e)},delRow:function(e){var t=this;return r()(s.a.mark(function a(){return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t.$confirm("此操作将删除该分类, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(o.h)({id:e.id}).then(function(e){0==e.code?(t.$message({message:"操作成功",type:"success"}),t.getData()):t.$message.error(e.message)})});case 1:case"end":return a.stop()}},a,t)}))()}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{staticClass:"flex mb2"},[a("el-col",{attrs:{span:20}}),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{type:"primary"},on:{click:e.addMainClass}},[e._v("新增一级分类")])],1)],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-key":"id","tree-props":{children:"son",hasChildren:"hasSon"}}},[a("el-table-column",{attrs:{prop:"id",label:"编号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"cate_name",label:"名称"}}),e._v(" "),a("el-table-column",{attrs:{label:"分类图"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("img",{staticClass:"smallPic",attrs:{src:t.row.image_url_full,alt:""},on:{click:function(a){return e.previewImg(t.row.image_url_full)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.fid?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.addSubClass(t.row)}}},[e._v("添加二级分类")]):e._e(),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.editRow(t.row)}}},[e._v("编辑")]),e._v(" "),t.row.candel?e._e():a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.delRow(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("AddNewClass",{ref:"addNewClass"}),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.origionPic,alt:""}})])],1)},staticRenderFns:[]};var m=a("VU/8")(u,f,!1,function(e){a("4/lZ")},"data-v-0f40dc56",null);t.default=m.exports},GAq7:function(e,t){}});
//# sourceMappingURL=7.ada20f61bf3737528049.js.map